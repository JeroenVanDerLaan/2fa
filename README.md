# 2FA

A simple PHP 2FA implementation

## Deployment

1. `docker-compose up -d --build`
2. `docker-compose exec php sh -c 'composer install --no-interaction'`
3. `docker-compose exec php sh -c 'mkdir --parents var/'`

## Usage

### Example

```php
<?php

use App\Qr\QrCodeGenerator;
use App\Secret\SecretGenerator;
use App\Secret\SecretValidator;
use Psr\Container\ContainerInterface;

/** @var ContainerInterface $container */
$container = require __DIR__ . '/../bootstrap/container.php';

// Generate a 2FA secret (to be associated with the user)
$secretGenerator = $container->get(SecretGenerator::class);
$secret = $secretGenerator->generate();

// Generate a 2FA QR code (to be scanned by the user using Google Authenticator)
$qrCodeGenerator = $container->get(QrCodeGenerator::class);
$qrCode = $qrCodeGenerator->generate($secret);

// Validate a 2FA key (generated by Google Authenticator) against the secret
$secretValidator = $container->get(SecretValidator::class);
$key = '123456';
$secretValidator->isValid($secret, $key);
```

### CLI

This package ships with a few CLI utilities for easy access to the 2FA implementation.

*Commands in this sections assume that PHP is running in the provided Docker environment.*

#### Generate a 2FA secret

Generate a 2FA secret:

`bin/console 2fa:secret`

Save the generated key for use in the next steps.

#### Generate a QR code

Generate a QR code using the generated secret:

`bin/console 2fa:qr --file=var/qr.png [SECRET]`

Replace `[SECRET]` with your generated 2FA secret.

The QR code will be written to `var/qr.png`.

#### Scan the QR code

Add a new account to your [Google Authenticator](https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en) app by opening `var/qr.png` and scanning the generated QR code.

Save the generated key for use in the next step.

#### Validate a 2FA key

Validate a key generated by the app against your 2FA secret:

`bin/console 2fa:validate [SECRET] [KEY]`

Replace `[SECRET]` with your generated 2FA secret.

Replace `[KEY]` with the key generated by the app.
